---
import type { ImageMetadata } from "astro";
import Image from "astro/components/Image.astro";

interface Props {
    title: string;
    link: string;
    description: string;
    imagePath: string;
    tags: string[];
}

type TagStyle = {
    tagColor: string;
    tagBg: string;
};

// Define the type for the tagStyles object
type TagStyles = {
    [key: string]: TagStyle; // This allows any string key
};

const { title, link, description, imagePath, tags } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>(
    "/src/images/cover/*.{jpeg,jpg,png,gif,webp}",
);
if (!images[imagePath])
    throw new Error(
        `"${imagePath}" does not exist in glob: "/images/*.{jpeg,jpg,png,gif}"`,
    );

const tagStyles: TagStyles = {
    typescript: { tagBg: "bg-typescript", tagColor: "dark:text-typescript" },
};
---

<div class="lg:flex justify-center">
    <a
        href={`/work/${link}`}
        aria-label="working link"
        class="block w-full group"
    >
        <div
            class="bg-white dark:bg-secondary h-auto lg:h-[28rem] rounded-2xl p-4 flex flex-col justify-between"
        >
            <!-- Text Section -->
            <div class="flex flex-col p-2 gap-3 mb-2">
                <p
                    class="text-xl lg:text-2xl font-sans font-medium line-clamp-2"
                >
                    {title}
                </p>
                <div class="flex flex-wrap gap-2">
                    {
                        tags.map((tag) => (
                            <span class="text-xs px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400">
                                {tag}
                            </span>
                        ))
                    }
                </div>
                <!-- Clamped description to prevent pushing image out -->
                <p class="text-base lg:text-lg dark:text-gray-300 line-clamp-3">
                    {description}
                </p>
            </div>

            <!-- Image Section -->
            <Image
                alt={`${title}-slide-article`}
                src={images[imagePath]()}
                height="135"
                width="308"
                quality={85}
                widths={[240, 540, 720]}
                sizes={`(max-width: 360px) 240px, (max-width: 720px) 540px, (max-width: 1600px) 720px`}
                loading={"eager"}
                class="rounded-xl w-full h-auto object-cover aspect-[308/135] mt-auto"
            />
        </div>
    </a>
</div>
